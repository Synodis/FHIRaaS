# Docker

# Build a Docker image 
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
- master

resources:
- repo: self

variables:
  - name: USER
    value: "_system"
  - name: PASSWORD
    value: "SYS"

stages:
- stage: Build
  displayName: Build image
  jobs:  
  - job: Build
    displayName: Build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - task: DockerCompose@0
      displayName: Docker-Compose
      inputs:
        containerregistrytype: 'Azure Container Registry'
        azureContainerRegistry: 'IRISaaS'
        dockerComposeFile: 'FHIRaaS/docker-compose.yml'
        action: 'Run a Docker Compose command'
        dockerComposeCommand: 'up -d'
    - task: CmdLine@2
      displayName: Install requests module for python
      inputs:
        script: 'pip install requests'
    - task: PythonScript@0
      displayName: Python Script API
      inputs:
        scriptSource: 'filepath'
        scriptPath: './FHIRaaS_API_Request_v2.py'